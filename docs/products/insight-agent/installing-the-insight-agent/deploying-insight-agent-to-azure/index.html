<!DOCTYPE html>
<html>
  <head>
    <title>Happy Robot</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="generator" content="Hugo 0.33" />
<title>Deploying Insight Agent to Azure :: Happy Robot</title>
<link rel="shortcut icon" href="/happy-robot-test/images/favicon.png" type="image/x-icon" />
<link href="/happy-robot-test/css/font-awesome.min.css" rel="stylesheet">
<link href="/happy-robot-test/css/nucleus.css" rel="stylesheet">
<link href="/happy-robot-test/theme-flex/style.css" rel="stylesheet">

<link rel="stylesheet" href="/happy-robot-test/css/bootstrap.min.css">
<script src="/happy-robot-test/js/jquery-2.x.min.js"></script>
<script type="text/javascript">
      var baseurl = "https:\/\/mkriskovic-r7.github.io\/happy-robot-test\/";
</script>
<meta name="description" content="">


    
  </head>
  <body data-url="/happy-robot-test/products/insight-agent/installing-the-insight-agent/deploying-insight-agent-to-azure/">
    
      <header>
  <div class="logo">
    
	
  
    <a class="baselink" href="https://mkriskovic-r7.github.io/happy-robot-test/">Happy Robot</a>
  

  </div>
  <div class="burger"><a href="javascript:void(0);" style="font-size:15px;">&#9776;</a></div>
</header>
<article>
  <aside>
    <ul class="menu">
          <li data-nav-id="/happy-robot-test/" class="dd-item">
          <a href="/happy-robot-test/">
            <i class="fa fa-fw fa-home"></i>
          </a>
          </li>
    <li data-nav-id="/happy-robot-test/support/" class="dd-item
        ">
      <div>
      <a href="/happy-robot-test/support/">_Index</a>
      </div>
    </li>
    <li data-nav-id="/happy-robot-test/community/" class="dd-item
        ">
      <div>
      <a href="/happy-robot-test/community/">_Index</a>
      </div>
    </li>
    <li data-nav-id="/happy-robot-test/products/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/happy-robot-test/products/">Products</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/happy-robot-test/products/appspider/landing/" class="dd-item">
        <div>
          <a href="/happy-robot-test/products/appspider/landing/">
            Landing
          </a>
        </div>
    </li>
      <li data-nav-id="/happy-robot-test/products/nexpose/landing/" class="dd-item">
        <div>
          <a href="/happy-robot-test/products/nexpose/landing/">
            Landing
          </a>
        </div>
    </li>
      <li data-nav-id="/happy-robot-test/products/insight-agent/installing-the-insight-agent/deploying-insight-agent-to-azure/" class="dd-item active">
        <div>
          <a href="/happy-robot-test/products/insight-agent/installing-the-insight-agent/deploying-insight-agent-to-azure/">
            Deploying Insight Agent to Azure
          </a>
        </div>
    </li>
      <li data-nav-id="/happy-robot-test/products/insight-agent/frequently-asked-questions/" class="dd-item">
        <div>
          <a href="/happy-robot-test/products/insight-agent/frequently-asked-questions/">
            Frequently Asked Questions
          </a>
        </div>
    </li>
      <li data-nav-id="/happy-robot-test/products/insight-agent/installing-the-insight-agent/installing-the-agent-using-gpos/" class="dd-item">
        <div>
          <a href="/happy-robot-test/products/insight-agent/installing-the-insight-agent/installing-the-agent-using-gpos/">
            Installing the Agent Using GPOs
          </a>
        </div>
    </li>
      <li data-nav-id="/happy-robot-test/products/insight-agent/installing-the-insight-agent/installing-the-agent-using-patch-management-software/" class="dd-item">
        <div>
          <a href="/happy-robot-test/products/insight-agent/installing-the-insight-agent/installing-the-agent-using-patch-management-software/">
            Installing the Agent Using Patch Management Software
          </a>
        </div>
    </li>
      <li data-nav-id="/happy-robot-test/products/insight-agent/installing-the-insight-agent/installing-the-agent-for-mcafee-epo-users/" class="dd-item">
        <div>
          <a href="/happy-robot-test/products/insight-agent/installing-the-insight-agent/installing-the-agent-for-mcafee-epo-users/">
            Installing the Agent for McAfee ePO Users
          </a>
        </div>
    </li>
      <li data-nav-id="/happy-robot-test/products/insight-agent/installing-the-insight-agent/" class="dd-item">
        <div>
          <a href="/happy-robot-test/products/insight-agent/installing-the-insight-agent/">
            Installing the Insight Agent
          </a>
        </div>
    </li>
      <li data-nav-id="/happy-robot-test/products/insight-agent/installing-the-insight-agent--deprecated-/" class="dd-item">
        <div>
          <a href="/happy-robot-test/products/insight-agent/installing-the-insight-agent--deprecated-/">
            Installing the Insight Agent (deprecated)
          </a>
        </div>
    </li>
      <li data-nav-id="/happy-robot-test/products/insight-agent/installing-the-insight-agent-in-silent-mode/" class="dd-item">
        <div>
          <a href="/happy-robot-test/products/insight-agent/installing-the-insight-agent-in-silent-mode/">
            Installing the Insight Agent in Silent Mode
          </a>
        </div>
    </li>
      <li data-nav-id="/happy-robot-test/products/insight-agent/system-requirements/" class="dd-item">
        <div>
          <a href="/happy-robot-test/products/insight-agent/system-requirements/">
            System Requirements
          </a>
        </div>
    </li>
      <li data-nav-id="/happy-robot-test/products/insight-agent/the-insight-agent/" class="dd-item">
        <div>
          <a href="/happy-robot-test/products/insight-agent/the-insight-agent/">
            The Insight Agent
          </a>
        </div>
    </li>
      <li data-nav-id="/happy-robot-test/products/insight-agent/the-insight-agent-communication-with-the-insight-platform/" class="dd-item">
        <div>
          <a href="/happy-robot-test/products/insight-agent/the-insight-agent-communication-with-the-insight-platform/">
            The Insight Agent Communication with the Insight Platform
          </a>
        </div>
    </li>
      <li data-nav-id="/happy-robot-test/products/insight-agent/the-insight-agent/using-the-agent-with-insightidr/" class="dd-item">
        <div>
          <a href="/happy-robot-test/products/insight-agent/the-insight-agent/using-the-agent-with-insightidr/">
            Using the Agent with InsightIDR
          </a>
        </div>
    </li>
      <li data-nav-id="/happy-robot-test/products/insight-agent/the-insight-agent/using-the-agent-with-insightops/" class="dd-item">
        <div>
          <a href="/happy-robot-test/products/insight-agent/the-insight-agent/using-the-agent-with-insightops/">
            Using the Agent with InsightOps
          </a>
        </div>
    </li>
      <li data-nav-id="/happy-robot-test/products/insight-agent/the-insight-agent/using-the-agent-with-insightvm/" class="dd-item">
        <div>
          <a href="/happy-robot-test/products/insight-agent/the-insight-agent/using-the-agent-with-insightvm/">
            Using the Agent with InsightVM
          </a>
        </div>
    </li>
        </ul>
    </li>




    </ul>
    <section>
    </section>
  </aside>
  <section class="page">
    
    <div class="nav-select">
      <center>Navigation : 
        <select onchange="javascript:location.href = this.value;">
          
    <option value="/happy-robot-test/support/" >
   _Index</option>
    <option value="/happy-robot-test/community/" >
   _Index</option>
    <option value="/happy-robot-test/products/" >
   Products</option> 
      <option value="/happy-robot-test/products/appspider/landing/" >- Landing</option>
      <option value="/happy-robot-test/products/nexpose/landing/" >- Landing</option>
      <option value="/happy-robot-test/products/insight-agent/installing-the-insight-agent/deploying-insight-agent-to-azure/"  selected>- Deploying Insight Agent to Azure</option>
      <option value="/happy-robot-test/products/insight-agent/frequently-asked-questions/" >- Frequently Asked Questions</option>
      <option value="/happy-robot-test/products/insight-agent/installing-the-insight-agent/installing-the-agent-using-gpos/" >- Installing the Agent Using GPOs</option>
      <option value="/happy-robot-test/products/insight-agent/installing-the-insight-agent/installing-the-agent-using-patch-management-software/" >- Installing the Agent Using Patch Management Software</option>
      <option value="/happy-robot-test/products/insight-agent/installing-the-insight-agent/installing-the-agent-for-mcafee-epo-users/" >- Installing the Agent for McAfee ePO Users</option>
      <option value="/happy-robot-test/products/insight-agent/installing-the-insight-agent/" >- Installing the Insight Agent</option>
      <option value="/happy-robot-test/products/insight-agent/installing-the-insight-agent--deprecated-/" >- Installing the Insight Agent (deprecated)</option>
      <option value="/happy-robot-test/products/insight-agent/installing-the-insight-agent-in-silent-mode/" >- Installing the Insight Agent in Silent Mode</option>
      <option value="/happy-robot-test/products/insight-agent/system-requirements/" >- System Requirements</option>
      <option value="/happy-robot-test/products/insight-agent/the-insight-agent/" >- The Insight Agent</option>
      <option value="/happy-robot-test/products/insight-agent/the-insight-agent-communication-with-the-insight-platform/" >- The Insight Agent Communication with the Insight Platform</option>
      <option value="/happy-robot-test/products/insight-agent/the-insight-agent/using-the-agent-with-insightidr/" >- Using the Agent with InsightIDR</option>
      <option value="/happy-robot-test/products/insight-agent/the-insight-agent/using-the-agent-with-insightops/" >- Using the Agent with InsightOps</option>
      <option value="/happy-robot-test/products/insight-agent/the-insight-agent/using-the-agent-with-insightvm/" >- Using the Agent with InsightVM</option>
  



        </select>
      </center>
    </div>
      <div>
        <div class="searchbox">
          <input data-search-input id="search-by" type="text" placeholder="Search...">
        </div>
        <script type="text/javascript" src="/happy-robot-test/js/lunr.min.js"></script>
        <script type="text/javascript" src="/happy-robot-test/js/auto-complete.js"></script>
        <link href="/happy-robot-test/css/auto-complete.css" rel="stylesheet">
        <script type="text/javascript">
          
              var baseurl = "https:\/\/mkriskovic-r7.github.io\/happy-robot-test\/";
          
        </script>
        <script type="text/javascript" src="/happy-robot-test/js/search.js"></script>
      </div>
    

    <h1>Deploying Insight Agent to Azure</h1>
    
    
    
    

<p>The Rapid7 Insight Agent connects your Azure virtual machines to solutions on the Rapid7 Insight platform.</p>

<p>To get started, download the agent configuration/installation package from the agent download page in InsightVM.</p>

<h1 id="installing-the-insight-agent-extension">Installing the Insight Agent extension</h1>

<p>To add the Rapid7 Insight Agent extension to a virtual machine, follow these steps:</p>

<ol>
<li>Download the configuration zip from your Insight Platform solution.</li>
<li>Apply the extension to the virtual machine through either the azure portal or command line.</li>
</ol>

<h2 id="using-azure-portal">Using Azure Portal</h2>

<p>In the Azure portal, navigate to:</p>

<ul>
<li><strong>Virtual Machines</strong> &gt; [VMname] &gt; <strong>Extensions</strong> &gt; <strong>Add</strong> button &gt; <strong>Rapid7 Insight Agent</strong> extension</li>
</ul>

<h2 id="using-command-line">Using Command Line</h2>

<p>[block:callout]
{
  &ldquo;type&rdquo;: &ldquo;info&rdquo;,
  &ldquo;body&rdquo;: &ldquo;Get the latest available extension version with the Azure CLI.&rdquo;
}
[/block]
1. Set up the <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Azure CLI</a> to <a href="https://docs.microsoft.com/en-us/cli/azure/vm/extension?view=azure-cli-latest">access the extension details</a>.
2. Log in with <code>az login</code>.
3. Browse Rapid7 extension versions with:</p>

<pre><code>az vm extension image list --publisher &quot;Rapid7.InsightPlatform&quot;
[{
    &quot;name&quot;: &quot;InsightAgentLinux&quot;,
    &quot;publisher&quot;: &quot;Rapid7.InsightPlatform&quot;,
    &quot;version&quot;: &quot;2.0.0.2&quot;
},
{
    &quot;name&quot;: &quot;InsightAgentWindows&quot;,
    &quot;publisher&quot;: &quot;Rapid7.InsightPlatform&quot;,
    &quot;version&quot;: &quot;2.0.0.2&quot;
},
...
</code></pre>

<h3 id="powershell">PowerShell</h3>

<p>To add the Rapid7 Insight Agent extension to a virtual machine using PowerShell, first make sure you have the <a href="https://github.com/Azure/azure-powershell#installation">latest version</a> of PowerShell installed.
[block:callout]
{
  &ldquo;type&rdquo;: &ldquo;warning&rdquo;,
  &ldquo;title&rdquo;: &ldquo;NOTE&rdquo;,
  &ldquo;body&rdquo;: &ldquo;Switching between classic and resource manager in the same PowerShell  window frequently results in an error:\n\n<code>Missing type map configuration or unsupported mapping</code>\n\nWhen using both types, it is recommended to use separate PowerShell windows.&rdquo;
}
[/block]
1. Base64 encode the configuration zip file:</p>

<pre><code>$filepath = C:\tmp\config.zip
$binary = Get-Content -Path $filepath -Encoding Byte
$base64 = [Convert]::ToBase64String($binary)
</code></pre>

<ol>
<li>Apply extension:</li>
</ol>

<p><strong>Classic</strong>:
Login: <code>Add-AzureAccount</code>
List VMs: <code>Get-AzureVM</code></p>

<pre><code>$params = &quot;{`&quot;configzip`&quot;: `&quot;$base64`&quot; }&quot;
$vmobj = Get-AzureVM -ServiceName {your_vm_service_name} \
-Name {your_vm_name}
$vmobj | Set-AzureVMExtension -ExtensionName
'InsightAgentWindows' \
-Publisher 'Rapid7.InsightPlatform' \
-Version 2.0 \
-PrivateConfiguration $params
$vmobj | Update-AzureVM   # This applies the extension
$vmobj | Get-AzureVMExtension
</code></pre>

<p><strong>Resource Manager</strong>:
Login: <code>Login-AzureRmAccount</code>
List VMs: <code>Get-AzureRmVM</code></p>

<pre><code>$params = @{&quot;configzip&quot; = &quot;$base64&quot;; };
Set-AzureRmVMExtension -Publisher Rapid7.InsightPlatform \
-ExtensionName InsightAgentWindows \
-ExtensionType InsightAgentWindows \
-Version 2.0 \
-ProtectedSettings $params \
-VMName {your_vm} \
-Location {your_location} \
-ResourceGroupName {your_resource_group}
</code></pre>

<h3 id="azure-2-0-cli">Azure 2.0 CLI</h3>

<p>To add the Rapid7 Insight Agent extension to a <strong>resource manager</strong> virtual machine using the Azure CLI, first make sure you have the latest version of the <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Azure 2.x CLI</a> installed.</p>

<pre><code>az login
base64=$(base64 ~/config.zip)
az vm extension set --protected-settings &quot;{\&quot;configzip\&quot;:\&quot;$base64\&quot;}&quot; --vm-name
{your_windows_vm} --name InsightAgentWindows --publisher Rapid7.InsightPlatform
--resource-group {vm-resource-group} --version 2.0
</code></pre>

<h3 id="azure-1-0-cli">Azure 1.0 CLI</h3>

<p>To add the Rapid7 Insight Agent extension to a <strong>classic</strong> virtual machine using the Azure CLI, first make sure you have the latest version of the <a href="https://docs.microsoft.com/en-us/azure/cli-install-nodejs">Azure 1.x CLI</a> installed.</p>

<pre><code>azure login
azure config mode asm
base64=$(base64 ~/config.zip)
azure vm extension set -t &quot;{\&quot;configzip\&quot;:\&quot;$base64\&quot;}&quot; &quot;{your_windows_vm}&quot;
InsightAgentWindows Rapid7.InsightPlatform 2.0
</code></pre>


    
    
        <div class="chevrons">
    <div id="navigation">
<a class="nav nav-prev" href="/happy-robot-test/products/insight-agent/installing-the-insight-agent/installing-the-agent-for-mcafee-epo-users/" title="Installing the Agent for McAfee ePO Users"> <i class="fa fa-chevron-left"></i><label>Installing the Agent for McAfee ePO Users</label></a>
    <a class="nav nav-next" href="/happy-robot-test/products/insight-agent/installing-the-insight-agent--deprecated-/" title="Installing the Insight Agent (deprecated)" style="margin-right: 0px;"><label>Installing the Insight Agent (deprecated)</label><i class="fa fa-chevron-right"></i></a></div>
  </div>

  </section>
</article>

<footer>

<div class="footline">
    

    

  

    <div class="github-link">
      <a href="products/insight-agent/Installing%20the%20Insight%20Agent/Deploying%20Insight%20Agent%20to%20Azure.md" target="blank"><i class="fa fa-code-fork"></i>
        Improve this page</a>
    </div>
  </div>


	<div>


  
    Create a content/_footer.md file to customize the footer content
  



	</div>
</footer>

<script src="/happy-robot-test/js/clipboard.min.js"></script>

<link href="/happy-robot-test/css/featherlight.min.css" rel="stylesheet">
<script src="/happy-robot-test/js/featherlight.min.js"></script>



<script src="/happy-robot-test/theme-flex/script.js"></script>

    

    
    

    
  </body>
</html>